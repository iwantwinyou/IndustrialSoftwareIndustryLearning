##### 							内存（物理）、虚拟内存学习

**1、什么是虚拟内存？**

​	百度百科：虚拟内存是计算机系统**内存管理的一种技术**。它使得应用程序认为它拥有连续的可用的内存（一个连续完整的地址空间），而实际上，它通常是被分隔成多个物理内存碎片，还有部分暂时存储在外部磁盘存储器上，在需要时进行数据交换。

《操作系统》：虚拟存储技术的基本思想时利用大容量外存来扩充内存，产生一个比有限的实际内存空间大得多的、逻辑的虚拟空间，简称虚存，以便能够有效地支持多道程序系统的实现和大型程序运行的需要，从而增强系统的处理能力。

一句话概括：**`虚拟内存是一种内存管理技术，是虚拟的、逻辑上存在的存储空间`**。

[什么是虚拟内存？虚拟内存的原理-CSDN博客](https://blog.csdn.net/blankmargin/article/details/118534348)

**2、虚拟内存的用途**：

​		如果计算机缺少运行程序操作所需的随机存取内存 (RAM)，则 Windows 使用虚拟内存进行补偿、（RAM理解为物理内存，相当于手机上的运行内存，而非存储。虚拟内存也称为**分页文件**，也就是那个 pagefile.sys文件。）

​		当 RAM 运行速度缓慢时，虚拟内存将数据从 RAM 移动到称为分页文件的空间中。将数据移入与移出分页文件可以释放 RAM，以便计算机可以完成工作。 一般而言，计算机的 RAM 越多，程序运行得越快。如果计算机的速度由于缺少 RAM 而降低，则可以尝试**增加虚拟内存**来进行补偿。但是，计算机从 虚拟内存读取数据的速度要比从RAM读取数据的**速度慢得多**，因此，想要质的提升系统运行效率，**增加 RAM** 才是**最根本的方法**。

[物理内存和虚拟内存的区别，带你秒懂这两者的区别 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/603229203)

**3、虚拟内存的是怎么工作的？**

​		当每个进程创建的时候，内核会为进程分配4G的虚拟内存，当进程还没有开始运行时，这只是一个内存布局。实际上并不立即就把虚拟内存对应位置的程序数据和代码（比如.text .data段）拷贝到物理内存中，只是建立好虚拟内存和磁盘文件之间的映射就好（叫做存储器映射）。这个时候数据和代码还是在磁盘上的。当运行到对应的程序时，进程去寻找页表，发现页表中地址没有存放在物理内存上，而是在磁盘上，于是发生缺页异常，于是将磁盘上的数据拷贝到物理内存中。

另外在进程运行过程中，要通过malloc来动态分配内存时，也只是分配了虚拟内存，即为这块虚拟内存对应的页表项做相应设置，当进程真正访问到此数据时，才引发缺页异常。

可以认为虚拟空间都被映射到了磁盘空间中（事实上也是按需要映射到磁盘空间上，通过mmap，mmap是用来建立虚拟空间和磁盘空间的映射关系的）

原文链接：https://blog.csdn.net/lvyibin890/article/details/82217193